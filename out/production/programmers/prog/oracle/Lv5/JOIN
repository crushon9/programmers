-- 상품을 구매한 회원 비율 구하기
USER_INFO 테이블과 ONLINE_SALE 테이블에서
2021년에 가입한 전체 회원들 중 상품을 구매한 회원수와 상품을 구매한 회원의 비율(=2021년에 가입한 회원 중 상품을 구매한 회원수 / 2021년에 가입한 전체 회원 수)을
년, 월 별로 출력하는 SQL문을 작성해주세요.
상품을 구매한 회원의 비율은 소수점 두번째자리에서 반올림하고,
전체 결과는 년을 기준으로 오름차순 정렬해주시고 년이 같다면 월을 기준으로 오름차순 정렬해주세요.

-- Ver 1
SELECT
YEAR
,MONTH
,COUNT(*) AS PUCHASED_USERS
,ROUND(COUNT(*)/(SELECT
             COUNT(*)
             FROM USER_INFO
             WHERE EXTRACT(YEAR FROM JOINED) = 2021),1) AS PUCHASED_RATIO
FROM
  (SELECT DISTINCT
        EXTRACT(YEAR FROM SALES_DATE) AS YEAR,
        EXTRACT(MONTH FROM SALES_DATE) AS MONTH,
        S.USER_ID
    FROM ONLINE_SALE S
    INNER JOIN USER_INFO I
    ON I.USER_ID = S.USER_ID
    WHERE EXTRACT(YEAR FROM JOINED) = 2021)
GROUP BY YEAR, MONTH
ORDER BY YEAR, MONTH

-- Ver2
SELECT
A.YEAR
,A.MONTH
,A.CNT AS PUCHASED_USERS
,ROUND(A.CNT/B.TOT,1) AS PUCHASED_RATIO
FROM
  (SELECT
        EXTRACT(YEAR FROM SALES_DATE) AS YEAR,
        EXTRACT(MONTH FROM SALES_DATE) AS MONTH,
        COUNT(DISTINCT S.USER_ID) AS CNT           ** COUNT(DISTINCT 컬럼)
    FROM ONLINE_SALE S
    INNER JOIN USER_INFO I
    ON I.USER_ID = S.USER_ID
    WHERE EXTRACT(YEAR FROM JOINED) = 2021
    GROUP BY EXTRACT(YEAR FROM SALES_DATE),EXTRACT(MONTH FROM SALES_DATE)) A
, (SELECT                                          ** 교집합이 없을땐 JOIN 보단 , 연결이 더 나음
        COUNT(*) AS TOT
   FROM USER_INFO
   WHERE EXTRACT(YEAR FROM JOINED) = 2021) B
ORDER BY A.YEAR, A.MONTH